<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–†—É—Ö —Ç–æ–≤–∞—Ä—ñ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            background-color: #f4f4f4;
        }
        h1, h2 { color: #333; }
        form, table {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #ccc; }
        th { background-color: #eaeaea; }
        input, select, button {
            padding: 8px;
            margin: 5px 0;
            border-radius: 6px;
            border: 1px solid #aaa;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover { background: #45a049; }
        .msg {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<h1>–†—É—Ö —Ç–æ–≤–∞—Ä—ñ–≤</h1>

<!-- ‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
<div th:if="${param.success}" class="msg success">‚úÖ –†—É—Ö —Ç–æ–≤–∞—Ä—É —É—Å–ø—ñ—à–Ω–æ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ!</div>
<div th:if="${error}" class="msg error">
    ‚ö†Ô∏è <span th:text="${error}"></span>
</div>

<!-- üîπ –§–æ—Ä–º–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –û–ü–ï–†–ê–¢–û–†–ê -->
<div th:if="${role == 'OPERATOR'}">

    <!-- –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <a href="/operator"><button type="button">‚¨Ö –ù–∞–∑–∞–¥</button></a>

    <!-- —Ñ–æ—Ä–º–∞ -->
    <form th:action="@{/operator/add}" th:object="${movement}" method="post">

        <label>–¢–æ–≤–∞—Ä:</label><br>
        <select th:field="*{item}" required>
            <option th:each="i : ${items}" th:value="${i.item_id}" th:text="${i.name}"></option>
        </select><br><br>

        <label>–¢–∏–ø —Ä—É—Ö—É:</label><br>
        <select name="movement_type" th:field="*{movement_type}" required>
            <option value="IN">–ü—Ä–∏—Ö—ñ–¥ (–æ–ø—Ä–∏–±—É—Ç–∫—É–≤–∞–Ω–Ω—è)</option>
            <option value="OUT">–í–∏–¥–∞—Ç–æ–∫ (—Å–ø–∏—Å–∞–Ω–Ω—è)</option>
            <option value="TRANSFER">–ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è</option>
        </select><br><br>

        <!-- üîÅ –ü–æ–ª—è –¥–ª—è –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è -->
        <div id="transferFields" style="display:none;">
            <label>–ó–≤—ñ–¥–∫–∏ –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏:</label><br>
            <select name="fromLocation" required>
                <option th:each="loc : ${locations}" th:value="${loc.location_id}"
                        th:text="${loc.rack + '-' + loc.level + '-' + loc.position}"></option>
            </select><br><br>

            <label>–ö—É–¥–∏ –ø–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏:</label><br>
            <select name="toLocation" required>
                <option th:each="loc : ${locations}" th:value="${loc.location_id}"
                        th:text="${loc.rack + '-' + loc.level + '-' + loc.position}"></option>
            </select><br><br>
        </div>

        <!-- üîπ –î–ª—è IN / OUT -->
        <div id="singleLocation">
            <label>–õ–æ–∫–∞—Ü—ñ—è (—Å—Ç–µ–ª–∞–∂ / —Ä—ñ–≤–µ–Ω—å / –ø–æ–ª–∏—Ü—è):</label><br>
            <select name="location" required>
                <option th:each="l : ${locations}" th:value="${l.location_id}"
                        th:text="${l.rack + '-' + l.level + '-' + l.position}"></option>
            </select><br><br>
        </div>

        <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</label><br>
        <input type="number" th:field="*{quantity}" min="1" required><br><br>

        <button type="submit">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ —Ä—É—Ö</button>
    </form>
</div>

<!-- üìä –¢–∞–±–ª–∏—Ü—è —ñ—Å—Ç–æ—Ä—ñ—ó —Ä—É—Ö—ñ–≤ -->
<h2>–Ü—Å—Ç–æ—Ä—ñ—è —Ä—É—Ö—ñ–≤ —Ç–æ–≤–∞—Ä—ñ–≤</h2>
<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>–¢–æ–≤–∞—Ä</th>
        <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
        <th>–¢–∏–ø —Ä—É—Ö—É</th>
        <th>–õ–æ–∫–∞—Ü—ñ—è</th>
        <th>–î–∞—Ç–∞</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="m : ${movements}">
        <td th:text="${m.movement_id}"></td>
        <td th:text="${m.item.name}"></td>
        <td th:text="${m.quantity}"></td>
        <td th:text="${m.movement_type}"></td>
        <td th:text="${m.location != null ? m.location.rack + '-' + m.location.level + '-' + m.location.position : '-'}"></td>
        <td th:text="${#temporals.format(m.date, 'yyyy-MM-dd HH:mm')}"></td>
    </tr>
    </tbody>
</table>

<!-- ‚öôÔ∏è JS –¥–ª—è —Ç–∏–ø—ñ–≤ —Ä—É—Ö—É -->
<script>
    const typeSelect = document.querySelector("[name='movement_type']");
    const transferFields = document.getElementById("transferFields");
    const singleLocation = document.getElementById("singleLocation");

    function updateVisibility() {
        if (!typeSelect) return;
        if (typeSelect.value === "TRANSFER") {
            transferFields.style.display = "block";
            singleLocation.style.display = "none";
        } else {
            transferFields.style.display = "none";
            singleLocation.style.display = "block";
        }
    }

    if (typeSelect) {
        typeSelect.addEventListener("change", updateVisibility);
        updateVisibility();
    }
</script>

</body>
</html>