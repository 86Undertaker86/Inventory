<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Керування локаціями</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/js/main.js}"></script>
</head>
<body>

<h1>Керування локаціями</h1>

<!-- Navigation buttons for returning and toggling forms -->
<div class="button-bar">
    <a href="/manager"><button class="first">Назад</button></a>
    <button id="toggleAddBtn" class="second">Додати локацію</button>
    <button id="toggleEditBtn" class="second">Редагувати локацію</button>
</div>

<!-- System messages for CRUD feedback -->
<div th:if="${param.success}" class="message success">Локацію додано!</div>
<div th:if="${param.updated}" class="message updated">Локацію оновлено!</div>
<div th:if="${param.deleted}" class="message deleted">Локацію видалено!</div>

<!-- Form for adding a new location -->
<div id="addForm" class="card hidden">
    <h2>Додати локацію</h2>
    <form th:action="@{/manager/locations/add}" th:object="${newLocation}" method="post">
        <input type="text" th:field="*{rack}" placeholder="Стелаж (напр. A)" required>
        <input type="text" th:field="*{level}" placeholder="Рівень (напр. 1)" required>
        <input type="text" th:field="*{position}" placeholder="Позиція (напр. 3)" required>
        <input type="text" th:field="*{description}" placeholder="Опис">
        <button type="submit">Додати</button>
    </form>
</div>

<!-- Form for editing an existing location -->
<div id="editForm" class="card hidden">
    <h2>Редагувати локацію</h2>

    <!-- Dropdown to select a location to edit -->
    <label for="locationSelect">Оберіть локацію:</label>
    <select id="locationSelect">
        <option value="">— Оберіть зі списку —</option>
        <option th:each="l : ${locations}"
                th:value="${l.location_id}"
                th:text="${l.rack + '-' + l.level + '-' + l.position}"></option>
    </select>

    <form id="locationEditForm" class="hidden"
          th:action="@{/manager/locations/update/__ID__}"
          th:object="${editLocation}" method="post">

        <input type="hidden" name="location_id" id="edit_id">
        <input type="text" id="edit_rack" name="rack" placeholder="Стелаж" required>
        <input type="text" id="edit_level" name="level" placeholder="Рівень" required>
        <input type="text" id="edit_position" name="position" placeholder="Позиція" required>
        <input type="text" id="edit_description" name="description" placeholder="Опис">
        <button type="submit">Оновити</button>
    </form>
</div>

<div id="locationsTable" class="card">
    <h2>Список локацій</h2>
    <input type="text" id="searchInput" class="search-bar" placeholder="Пошук...">

    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Стелаж</th>
            <th>Рівень</th>
            <th>Позиція</th>
            <th>Опис</th>
            <th>Дії</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="l : ${locations}">
            <td th:text="${l.location_id}"></td>
            <td th:text="${l.rack}"></td>
            <td th:text="${l.level}"></td>
            <td th:text="${l.position}"></td>
            <td th:text="${l.description}"></td>
            <td>
                <!-- Delete link with confirmation -->
                <a th:href="@{'/manager/locations/delete/' + ${l.location_id}}"
                   onclick="return confirm('Видалити локацію?');">Видалити</a>
            </td>
        </tr>

        <!-- Fallback row if there are no locations -->
        <tr th:if="${#lists.isEmpty(locations)}">
            <td colspan="6" class="no-data">Даних не знайдено</td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>